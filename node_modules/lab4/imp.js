const Koa = require('koa');
const app = new Koa();
const koaStatic = require('koa-static');
const Router = require('koa-router');

const root = '';
const opts = {};

const fs = require('fs');

var router = new Router();

router.get('/cats', (ctx, next) => {
  const fileContent = fs.readFileSync('./cats.json');

  ctx.body = fileContent.toString();
});

router.get('/postCat', (ctx, next) => {

  const allCats = JSON.parse(fs.readFileSync('./cats.json'));

  allCats.push(ctx.query);

  fs.writeFileSync('./cats.json', JSON.stringify(allCats));

  ctx.body = '{"success":1}'
});

app.use(router.routes());

app.use(koaStatic(root, opts));

const port = 3001

app.listen(port, () => {
  console.log('App started at port ' + port);
});
